## mongoose-connection-promise

> Convenience library to connect Mongoose to a MongoDB instance using promises.

[![CircleCI](https://circleci.com/gh/stefanwalther/mongoose-connection-promise/tree/master.svg?style=svg)](https://circleci.com/gh/stefanwalther/mongoose-connection-promise/tree/master)
[![XO code style](https://img.shields.io/badge/code_style-XO--space-5ed9c7.svg)](https://github.com/sindresorhus/xo-space)

## Table of Contents

<details>
- [Install](#install)
- [Usage](#usage)
- [API](#api)
- [Test](#test)
- [Author](#author)
- [License](#license)

_(TOC generated by [verb](https://github.com/verbose/verb) using [markdown-toc](https://github.com/jonschlinkert/markdown-toc))_
</details>

## Install

Install with [npm](http://npmjs.org/)

```sh
npm install mongoose-connection-promise
```

Install with [yarn](https://yarnpkg.com)

```sh
yarn add mongoose-connection-promise
```

## Usage

### Use mongoose-connection-promise in express.js

Connect mongoose to a MongoDB instance using the default settings:

```js
const express = require('express');
const MongooseConnection = require('mongoose-connection-promise');

const app = express();

// Initialize using the default settings, which is assuming MongoDB to run
// at mongodb://localhost:27017
const mongooseConnection = new MongooseConnection();

console.log(mongooseConnection.config.host); // Returns localhost
console.log(mongooseConnection.config.port): // Returns 27017

mongooseConnection.connect()
  .then(connection => {
    app.db = connection;
    const port = 3003;
    app.listen(port, err => {
      if (err) {
        console.log('Could not start express server');
      } else {
        console.log(`Express server started at port ${port}`);
      }
    });
  })
  .catch(err => {
    console.log('Error creating a mongoose connection', err);
  });
```

Pass in options:

```js
const MongooseConnection = require('mongoose-connection-promise');

const opts = {
  username: 'foo',
  password: 'bar',
  host: 'mongo.local',
  port: 27018,
  debug: true
};

const mongooseConnection = new MongooseConnection(opts);

mongooseConnection.connect()
  .then(connection => {
    // successfully connected
  })
  .catch(err => {
    // an error occurred
  });
```

## API

### [Configuration](lib/index.js#L65)

Define a configuration object to pass to the constructor.

If no options are defined, the default options will be used:

**Example**

```js
// Default Options:
const defaultOpts = {
   debug: false,
   host: 'localhost',
   port: 27017,
   database: '',
   connectOptions: {
     db: {},
     server: {},
     replset: {},
     user: {},
     pass: {},
     auth: {},
     mongos: {}
   }
};
```

**Params**

* `opts` **{Object}**: Options to pass in.
* `opts.debug` **{Boolean}**: Whether MongoDB runs in debug mode or not.
* `opts.host` **{String}**: The MongoDBhost, defaults to `localhost`.  See the mongodb [connection string spec](https://docs.mongodb.com/manual/reference/connection-string/) for more details.
* `opts.port` **{Number}**: The MongoDB port, defaults to `27017`.  See the mongodb [connection string spec](https://docs.mongodb.com/manual/reference/connection-string/) for more details.
* `opts.database` **{String}**: The MongoDB database, defaults to `admin`.  See the mongodb [connection string spec](https://docs.mongodb.com/manual/reference/connection-string/) for more details.
* `opts.connectOptions` **{Object}**: The MongoDB connection properties, being passed through to the native MongoDB driver. See [mongoose' documentation](http://mongoosejs.com/docs/connections.html), resp. [MongoDB's native driver for node.js' documentation](https://github.com/mongodb/node-mongodb-native) for more details.

### [.constructor()](lib/index.js#L74)

Initialize a new MongooseConnection.

**Params**

* **{Configuration}**: opts - Options to initialize _MongooseConnection_.

### [.connect()](lib/index.js#L90)

Connect mongoose to the given instance of MongoDB.

* `returns` **{Promise}**

### [.get()](lib/index.js#L112)

Get an existing connection or create a new one.

In contrary to `.connect()` this method will not create a new connection if MongooseConnection is already connected,
but the existing connection will be re-used and returned.

* `returns` **{Promise<NavtiveConnection,Error>}**: Returns the connection to MongoDB.

### [.disconnect()](lib/index.js#L126)

Disconnects all mongoose connections.

* `returns` **{Promise<void,Error>}**

### [.isConnected()](lib/index.js#L137)

Indicates whether there is a current and ready-to-use mongoose connection.

* `returns` **{boolean}**

## Test

Start the MongoDB docker container:

```sh
yarn dc-dev-up
```

Then run the tests:

```
yarn test
```

## Author

**Stefan Walther**

* [github/stefanwalther](https://github.com/stefanwalther)
* [twitter/waltherstefan](http://twitter.com/waltherstefan)

## License

Released under the MIT license.

***

_This file was generated by [verb-generate-readme](https://github.com/verbose/verb-generate-readme), v0.2.0, on February 14, 2017._